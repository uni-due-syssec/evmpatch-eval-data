#!/bin/sh

SOLCVERSION=0.4.22
#SOLCVERSION=0.5.8

# solidity > 0.5 supports this option to target older EVM forks
#--evm-version $(EVMVERSION) 
# Oyente doesn't support later EVM versions
EVMVERSION=byzantium
# latest one see https://solidity.readthedocs.io/en/v0.5.8/using-the-compiler.html?highlight=library#setting-the-evm-version-to-target
#EVMVERSION=petersburg

set -e
for d in ./*; do
    if test -d $d; then
        echo ""
        echo "#########################################################"
        pushd $d
        for c in ./*.sol; do 
            echo "----------------"
            echo $c; 
            sudo docker run --rm -it -v $PWD:/data:Z ethereum/solc:$SOLCVERSION \
                --bin --bin-runtime --hashes \
                --overwrite -o /data/ /data/$c 
        done
        echo "----------------"
        popd
        echo ""
    fi
done

echo "done"
