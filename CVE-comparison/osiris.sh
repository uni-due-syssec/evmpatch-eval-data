#!/bin/bash
DOCKER_IMAGE=osiris

osiris() {
    echo "Running OSIRIS on $1/$2"
    pushd $1
    for cmd in "sudo docker" "echo"; do
        $cmd run --rm -it -v $PWD:/data:Z \
            $DOCKER_IMAGE \
            osiris/osiris.py $3 -s "/data/$2" 2>&1 | tee -a osiris.log
    done
    printf "\n#####################################\n\n" >> osiris.log
    popd
}

echo "deleting existing osiris.log files!"
find . -name "osiris.log" -delete

# we're running with different symexec parameters:

# We tested the following settings for osiris, but we used the ones below,
# which seemd to work pretty OKish for the contracts we have.
#find ./burnOverflow_Hexagon -name "osiris.log" -delete
#osiris ./burnOverflow_Hexagon burnOverflow_Hexagon.bin "--bytecode -t 10"
#osiris ./burnOverflow_Hexagon burnOverflow_Hexagon.bin "--bytecode -t 25 -glt 200"
#osiris ./burnOverflow_Hexagon burnOverflow_Hexagon.bin "--bytecode -glt 1800"
#osiris ./burnOverflow_Hexagon burnOverflow_Hexagon.sol "-glt 120"
#osiris ./burnOverflow_Hexagon burnOverflow_Hexagon.sol "-glt 120 -t 10"
#exit 0


osiris ./batchOverflow_BecToken BecToken.bin-runtime "--bytecode -t 10"
osiris ./batchOverflow_BecToken BecToken.bin-runtime "--bytecode -glt 1800"
osiris ./batchOverflow_BecToken batchOverflow_BecToken.sol "-glt 120"

osiris ./burnOverflow_Hexagon Hexagon.bin-runtime "--bytecode -t 10"
osiris ./burnOverflow_Hexagon Hexagon.bin-runtime "--bytecode -glt 1800"
osiris ./burnOverflow_Hexagon burnOverflow_Hexagon.sol "-glt 120"

osiris ./multiOverflow_Token Token.bin-runtime "--bytecode -t 10"
osiris ./multiOverflow_Token Token.bin-runtime "--bytecode -glt 1800"
osiris ./multiOverflow_Token multiOverflow_Token.sol "-glt 120"

osiris ./proxyOverflow_SMT SMT.bin-runtime "--bytecode -t 10"
osiris ./proxyOverflow_SMT SMT.bin-runtime "--bytecode -glt 1800"
osiris ./proxyOverflow_SMT proxyOverflow_SMT.sol "-glt 120"

osiris ./transferFlaw_UselessEthereumToken UselessEthereumToken.bin-runtime "--bytecode -t 10"
osiris ./transferFlaw_UselessEthereumToken UselessEthereumToken.bin-runtime "--bytecode -glt 1800"
osiris ./transferFlaw_UselessEthereumToken transferFlaw_UselessEthereumToken.sol "-glt 120"


